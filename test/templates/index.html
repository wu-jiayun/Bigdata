<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ²ƒåœŸè§„åˆ’å¸ˆ - Sparkå†œä¸šåˆ†æç³»ç»Ÿ</title>
    
    <!-- ä½¿ç”¨æœ¬åœ°Bootstrap CSSï¼Œé¿å…CDNè¶…æ—¶ -->
    <style>
        /* Bootstrapæ ¸å¿ƒæ ·å¼ - å†…è”é¿å…CDNé—®é¢˜ */
        * { box-sizing: border-box; }
        body { margin: 0; font-family: Arial, sans-serif; background: #f8f9fa; min-height: 100vh; }
        .container-fluid { width: 100%; padding: 0 15px; }
        .row { display: flex; flex-wrap: wrap; margin: 0 -15px; }
        .col-12 { flex: 0 0 100%; max-width: 100%; padding: 0 15px; }
        .col-md-4 { flex: 0 0 33.333333%; max-width: 33.333333%; padding: 0 15px; }
        .col-md-6 { flex: 0 0 50%; max-width: 50%; padding: 0 15px; }
        .mt-4 { margin-top: 1.5rem; }
        .mb-4 { margin-bottom: 1.5rem; }
        .me-2 { margin-right: 0.5rem; }
        .me-3 { margin-right: 1rem; }
        .w-100 { width: 100%; }
        
        /* ç®€åŒ–å¯¼èˆªæ  */
        .navbar {
            background: #343a40;
            padding: 1rem 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .navbar-brand {
            color: white !important;
            font-size: 1.5rem;
            font-weight: 700;
            text-decoration: none;
            display: flex;
            align-items: center;
        }
        
        .navbar-text {
            color: rgba(255,255,255,0.9);
            display: flex;
            align-items: center;
            font-weight: 500;
        }
        
        /* ç°ä»£åŒ–å¡ç‰‡è®¾è®¡ */
        .card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
            overflow: hidden;
        }
        
        .card-header {
            background: #f8f9fa;
            color: #333;
            font-weight: normal;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            align-items: center;
        }
        
        .card-body {
            padding: 2rem 1.5rem;
        }
        
        /* ç®€åŒ–æŒ‰é’®è®¾è®¡ */
        .btn {
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 8px 16px;
            font-weight: normal;
            cursor: pointer;
            display: inline-block;
            text-decoration: none;
            background: white;
            color: #333;
        }
        
        .btn-spark {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        .btn-spark:hover {
            background: #0056b3;
            border-color: #0056b3;
            color: white;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
            border-color: #28a745;
        }
        
        .btn-success:hover {
            background: #1e7e34;
            border-color: #1e7e34;
            color: white;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .btn-lg {
            padding: 15px 40px;
            font-size: 1.1rem;
        }
        
        /* ç®€åŒ–è­¦å‘Šæ¡† */
        .alert {
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 12px 16px;
            margin-bottom: 1rem;
        }
        
        .alert-info {
            background: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }
        
        .alert-success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        
        .alert-secondary {
            background: #e2e3e5;
            border-color: #d6d8db;
            color: #383d41;
        }
        
        /* ç®€åŒ–æ ‡ç­¾é¡µ */
        .nav-tabs {
            border-bottom: 1px solid #dee2e6;
            margin-bottom: 1rem;
        }
        
        .nav-link {
            border: 1px solid transparent;
            border-radius: 4px 4px 0 0;
            color: #495057;
            padding: 8px 16px;
            margin-bottom: -1px;
            text-decoration: none;
            background: none;
        }
        
        .nav-link:hover {
            color: #007bff;
            border-color: #e9ecef #e9ecef #dee2e6;
        }
        
        .nav-link.active {
            background: white;
            color: #495057;
            border-color: #dee2e6 #dee2e6 white;
        }
        
        .tab-content {
            background: transparent;
        }
        
        .tab-pane {
            display: none;
        }
        
        .tab-pane.show.active {
            display: block;
        }
        
        /* å›¾è¡¨å®¹å™¨ä¼˜åŒ– */
        .chart-container {
            width: 100%;
            height: 400px;
            margin: 20px 0;
            min-height: 400px;
            position: relative;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            background: white;
        }
        
        /* çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        
        .status-ready { 
            background-color: #00b894;
        }
        
        .status-loading { 
            background-color: #fdcb6e;
        }
        
        .status-error { 
            background-color: #e17055;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        /* å›¾æ ‡å­—ä½“ - ä½¿ç”¨Unicodeç¬¦å·æ›¿ä»£Font Awesome */
        .icon-rocket::before { content: "ğŸš€"; margin-right: 8px; }
        .icon-chart::before { content: "ğŸ“Š"; margin-right: 8px; }
        .icon-cogs::before { content: "âš™ï¸"; margin-right: 8px; }
        .icon-seedling::before { content: "ğŸŒ±"; margin-right: 8px; }
        .icon-thermometer::before { content: "ğŸŒ¡ï¸"; margin-right: 8px; }
        .icon-mountain::before { content: "ğŸ”ï¸"; margin-right: 8px; }
        .icon-map::before { content: "ğŸ—ºï¸"; margin-right: 8px; }
        .icon-info::before { content: "â„¹ï¸"; margin-right: 8px; }
        .icon-check::before { content: "âœ…"; margin-right: 8px; }
        .icon-warning::before { content: "âš ï¸"; margin-right: 8px; }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .col-md-4, .col-md-6 {
                flex: 0 0 100%;
                max-width: 100%;
            }
            
            .btn-lg {
                padding: 12px 25px;
                font-size: 1rem;
            }
            
            .card-body {
                padding: 1.5rem 1rem;
            }
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
    
    <!-- EChartsåº“ -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
</head>
<body>
    <!-- ç°ä»£åŒ–å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="container-fluid">
            <div class="row w-100 align-items-center">
                <div class="col-md-6">
                    <a class="navbar-brand" href="#">
                        <span class="icon-seedling"></span>æ²ƒåœŸè§„åˆ’å¸ˆ - Sparkå†œä¸šåˆ†æç³»ç»Ÿ
                    </a>
                </div>
                <div class="col-md-6" style="text-align: right;">
                    <span class="navbar-text">
                        <span id="systemStatus" class="status-indicator status-loading"></span>
                        <span id="statusText">ç³»ç»ŸçŠ¶æ€: æœªåˆå§‹åŒ–</span>
                    </span>
                </div>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <!-- ç°ä»£åŒ–æ§åˆ¶é¢æ¿ -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <span class="icon-cogs"></span>ç³»ç»Ÿæ§åˆ¶é¢æ¿
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <button id="initSystemBtn" class="btn btn-spark btn-lg me-3">
                                    <span class="icon-rocket"></span>åˆå§‹åŒ–Sparkç³»ç»Ÿ
                                </button>
                            </div>
                            <div class="col-md-6">
                                <div id="systemInfo" class="alert alert-info">
                                    <span class="icon-info"></span>
                                    è¯·å…ˆåˆå§‹åŒ–Sparkç³»ç»Ÿä»¥è¿æ¥MySQLæ•°æ®åº“
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <button id="runAnalysisBtn" class="btn btn-success btn-lg w-100" disabled>
                                    <span class="icon-chart"></span>è¿è¡Œç»¼åˆåˆ†æ
                                </button>
                            </div>
                            <div class="col-md-6">
                                <div id="analysisInfo" class="alert alert-secondary">
                                    <span class="icon-info"></span>
                                    è¯·å…ˆåˆå§‹åŒ–ç³»ç»Ÿï¼Œç„¶åè¿è¡Œç»¼åˆåˆ†æ
                                </div>
                            </div>
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>


        <!-- ç°ä»£åŒ–æ ‡ç­¾é¡µå¯¼èˆª -->
        <ul class="nav nav-tabs" id="chartTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="climate-tab" data-bs-toggle="tab" data-bs-target="#climate" type="button" role="tab">
                    <span class="icon-thermometer"></span>æ°”å€™è¶‹åŠ¿åˆ†æ
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="soil-tab" data-bs-toggle="tab" data-bs-target="#soil" type="button" role="tab">
                    <span class="icon-mountain"></span>åœŸå£¤åˆ†å¸ƒåˆ†æ
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="crop-tab" data-bs-toggle="tab" data-bs-target="#crop" type="button" role="tab">
                    <span class="icon-seedling"></span>ä½œç‰©é€‚å®œæ€§åˆ†æ
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="zoning-tab" data-bs-toggle="tab" data-bs-target="#zoning" type="button" role="tab">
                    <span class="icon-map"></span>åŒºåˆ’ä¼˜åŒ–å»ºè®®
                </button>
            </li>
        </ul>

        <!-- å›¾è¡¨å†…å®¹åŒºåŸŸ -->
        <div class="tab-content mt-4" id="chartTabsContent">
            <!-- æ°”å€™åˆ†æ -->
            <div class="tab-pane fade show active" id="climate" role="tabpanel">
                <div class="row">
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">ğŸŒ¡ï¸ æœˆåº¦æ¸©åº¦å˜åŒ–è¶‹åŠ¿</div>
                            <div class="card-body">
                                <div id="tempTrendChart" class="chart-container"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">ğŸ“ˆ å¹´åº¦æ¸©åº¦è¶‹åŠ¿</div>
                            <div class="card-body">
                                <div id="precipPatternChart" class="chart-container"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">ğŸ”¥ å­£èŠ‚æ¸©åº¦å¯¹æ¯”</div>
                            <div class="card-body">
                                <div id="climateHeatmapChart" class="chart-container"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- åœŸå£¤åˆ†æ -->
            <div class="tab-pane fade" id="soil" role="tabpanel">
                <div class="row">
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">ğŸ”ï¸ åœŸå£¤ç±»å‹åˆ†å¸ƒ</div>
                            <div class="card-body">
                                <div id="soilTypePieChart" class="chart-container"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">âš—ï¸ pHå€¼åˆ†å¸ƒ</div>
                            <div class="card-body">
                                <div id="phDistChart" class="chart-container"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">ğŸ† å¿å¸‚åœŸå£¤è´¨é‡æ’å</div>
                            <div class="card-body">
                                <div id="countyQualityChart" class="chart-container"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä½œç‰©åˆ†æ -->
            <div class="tab-pane fade" id="crop" role="tabpanel">
                <div class="row">
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">ğŸŒ¾ ä½œç‰©åˆ†ç±»åˆ†å¸ƒ</div>
                            <div class="card-body">
                                <div id="suitabilityDistChart" class="chart-container"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">ğŸŒ¡ï¸ ä½œç‰©æ¸©åº¦éœ€æ±‚</div>
                            <div class="card-body">
                                <div id="cropRadarChart" class="chart-container"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">âš–ï¸ ä½œç‰©pHé€‚åº”æ€§</div>
                            <div class="card-body">
                                <div id="limitingFactorsChart" class="chart-container"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- åŒºåˆ’åˆ†æ -->
            <div class="tab-pane fade" id="zoning" role="tabpanel">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">ğŸ—ºï¸ åŒºåˆ’ä¼˜åŒ–åˆ†å¸ƒ</div>
                            <div class="card-body">
                                <div id="zoningScatterChart" class="chart-container"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">ğŸ¯ æœ€ä½³ç§æ¤åŒºåŸŸ</div>
                            <div class="card-body">
                                <div id="optimizationMapChart" class="chart-container"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('ğŸš€ å¯åŠ¨ä¼˜åŒ–ç‰ˆå†œä¸šåˆ†æç³»ç»Ÿ...');
        
        // å…¨å±€å˜é‡
        window.SparkCore = {
            charts: {},
            systemStatus: 'uninitialized'
        };
        
        
        // ç®€åŒ–çš„æ ‡ç­¾é¡µåˆ‡æ¢
        function initTabs() {
            const tabs = document.querySelectorAll('[data-bs-toggle="tab"]');
            tabs.forEach(tab => {
                tab.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // ç§»é™¤æ‰€æœ‰activeç±»
                    tabs.forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-pane').forEach(pane => {
                        pane.classList.remove('show', 'active');
                    });
                    
                    // æ·»åŠ activeç±»åˆ°å½“å‰æ ‡ç­¾
                    this.classList.add('active');
                    const target = document.querySelector(this.getAttribute('data-bs-target'));
                    if (target) {
                        target.classList.add('show', 'active');
                        
                        // æ ‡ç­¾é¡µåˆ‡æ¢åï¼Œè°ƒæ•´å›¾è¡¨å°ºå¯¸
                        setTimeout(() => {
                            console.log('ğŸ”„ æ ‡ç­¾é¡µåˆ‡æ¢ï¼Œè°ƒæ•´å›¾è¡¨å°ºå¯¸');
                            const chartContainers = target.querySelectorAll('.chart-container');
                            chartContainers.forEach(container => {
                                const chartId = container.id;
                                if (chartId && window.SparkCore.charts[chartId]) {
                                    try {
                                        window.SparkCore.charts[chartId].resize();
                                        console.log(`âœ… ${chartId} å°ºå¯¸è°ƒæ•´æˆåŠŸ`);
                                    } catch (error) {
                                        console.error(`âŒ ${chartId} å°ºå¯¸è°ƒæ•´å¤±è´¥:`, error);
                                    }
                                }
                            });
                        }, 100);
                    }
                });
            });
        }
        
        // åˆå§‹åŒ–å›¾è¡¨å®¹å™¨
        function initCharts() {
            const chartIds = [
                'tempTrendChart', 'precipPatternChart', 'climateHeatmapChart',
                'soilTypePieChart', 'phDistChart', 'countyQualityChart',
                'suitabilityDistChart', 'cropRadarChart', 'limitingFactorsChart',
                'zoningScatterChart', 'optimizationMapChart'
            ];

            console.log('ğŸ”„ åˆå§‹åŒ–å›¾è¡¨å®¹å™¨...');
            
            chartIds.forEach(id => {
                const element = document.getElementById(id);
                if (element && typeof echarts !== 'undefined') {
                    try {
                        // æ¸…é™¤å®¹å™¨å†…å®¹å¹¶è®¾ç½®å°ºå¯¸
                        element.innerHTML = '';
                        element.style.width = '100%';
                        element.style.height = '400px';
                        
                        // åˆå§‹åŒ–EChartså®ä¾‹
                        window.SparkCore.charts[id] = echarts.init(element);
                        console.log(`âœ… ${id} åˆå§‹åŒ–æˆåŠŸ`);
                    } catch (error) {
                        console.error(`âŒ ${id} åˆå§‹åŒ–å¤±è´¥:`, error);
                    }
                }
            });
        }
        
        
        // æ›´æ–°ç³»ç»ŸçŠ¶æ€
        function updateSystemStatus(status, message) {
            const statusIndicator = document.getElementById('systemStatus');
            const statusText = document.getElementById('statusText');
            
            if (statusIndicator && statusText) {
                statusIndicator.className = `status-indicator status-${status}`;
                statusText.textContent = `ç³»ç»ŸçŠ¶æ€: ${message}`;
            }
        }
        
        // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
        function showLoading(buttonId) {
            const button = document.getElementById(buttonId);
            if (button) {
                button.innerHTML = '<span class="loading-spinner"></span>' + button.textContent;
                button.disabled = true;
            }
        }
        
        function hideLoading(buttonId, originalText) {
            const button = document.getElementById(buttonId);
            if (button) {
                button.innerHTML = originalText;
                button.disabled = false;
            }
        }
        
        // åˆå§‹åŒ–ç³»ç»Ÿ
        async function initializeSystem() {
            console.log('ğŸš€ åˆå§‹åŒ–ç³»ç»Ÿ...');
            showLoading('initSystemBtn');
            updateSystemStatus('loading', 'åˆå§‹åŒ–ä¸­...');
            
            try {
                const response = await fetch('/api/system/initialize', { method: 'POST' });
                const result = await response.json();
                
                if (result.status === 'success') {
                    updateSystemStatus('ready', 'ç³»ç»Ÿå°±ç»ª');
                    
                    document.getElementById('systemInfo').innerHTML = 
                        '<span class="icon-check"></span>ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸï¼';
                    document.getElementById('systemInfo').className = 'alert alert-success';
                    document.getElementById('runAnalysisBtn').disabled = false;
                    hideLoading('initSystemBtn', '<span class="icon-rocket"></span>åˆå§‹åŒ–Sparkç³»ç»Ÿ');
                    showNotification('ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸï¼', 'success');
                } else {
                    updateSystemStatus('error', 'åˆå§‹åŒ–å¤±è´¥');
                    document.getElementById('systemInfo').innerHTML = 
                        '<span class="icon-warning"></span>åˆå§‹åŒ–å¤±è´¥: ' + result.message;
                    hideLoading('initSystemBtn', '<span class="icon-rocket"></span>åˆå§‹åŒ–Sparkç³»ç»Ÿ');
                    showNotification('åˆå§‹åŒ–å¤±è´¥', 'error');
                }
            } catch (error) {
                updateSystemStatus('error', 'è¿æ¥å¤±è´¥');
                hideLoading('initSystemBtn', '<span class="icon-rocket"></span>åˆå§‹åŒ–Sparkç³»ç»Ÿ');
                showNotification('ç½‘ç»œè¿æ¥å¤±è´¥', 'error');
                console.error('âŒ åˆå§‹åŒ–å¼‚å¸¸:', error);
            }
        }
        
        // è¿è¡Œåˆ†æ
        async function runAnalysis() {
            console.log('ğŸ”¬ è¿è¡Œåˆ†æ...');
            showLoading('runAnalysisBtn');
            updateSystemStatus('loading', 'åˆ†æä¸­...');
            
            try {
                const response = await fetch('/api/analysis/run', { method: 'POST' });
                const result = await response.json();
                
                if (result.status === 'success') {
                    updateSystemStatus('ready', 'åˆ†æå®Œæˆ');
                    document.getElementById('analysisInfo').innerHTML = 
                        '<span class="icon-check"></span>åˆ†æå®Œæˆï¼æ­£åœ¨åŠ è½½å›¾è¡¨...';
                    document.getElementById('analysisInfo').className = 'alert alert-success';
                    
                    await loadAllCharts();
                    hideLoading('runAnalysisBtn', '<span class="icon-chart"></span>è¿è¡Œç»¼åˆåˆ†æ');
                } else {
                    updateSystemStatus('error', 'åˆ†æå¤±è´¥');
                    document.getElementById('analysisInfo').innerHTML = 
                        '<span class="icon-warning"></span>åˆ†æå¤±è´¥: ' + result.message;
                    hideLoading('runAnalysisBtn', '<span class="icon-chart"></span>è¿è¡Œç»¼åˆåˆ†æ');
                }
            } catch (error) {
                updateSystemStatus('error', 'åˆ†æå¼‚å¸¸');
                hideLoading('runAnalysisBtn', '<span class="icon-chart"></span>è¿è¡Œç»¼åˆåˆ†æ');
                console.error('âŒ åˆ†æå¼‚å¸¸:', error);
            }
        }
        
        // åŠ è½½æ‰€æœ‰å›¾è¡¨ - ä½¿ç”¨ç»Ÿä¸€çš„é‡æ–°åˆå§‹åŒ–æ–¹æ³•
        async function loadAllCharts() {
            console.log('ğŸ“Š å¼€å§‹åŠ è½½æ‰€æœ‰å›¾è¡¨...');
            
            try {
                // é‡æ–°åˆå§‹åŒ–æ‰€æœ‰å›¾è¡¨
                const chartIds = [
                    'tempTrendChart', 'precipPatternChart', 'climateHeatmapChart',
                    'soilTypePieChart', 'phDistChart', 'countyQualityChart',
                    'suitabilityDistChart', 'cropRadarChart', 'limitingFactorsChart',
                    'zoningScatterChart', 'optimizationMapChart'
                ];
                
                chartIds.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.innerHTML = '';
                        element.style.width = '100%';
                        element.style.height = '400px';
                        
                        if (typeof echarts !== 'undefined') {
                            window.SparkCore.charts[id] = echarts.init(element);
                            console.log(`ğŸ”„ ${id} é‡æ–°åˆå§‹åŒ–å®Œæˆ`);
                        }
                    }
                });
                
                // å…ˆåŠ è½½ç¤ºä¾‹æ•°æ®ï¼Œå†åŠ è½½APIæ•°æ®
                setTimeout(async () => {
                    // åŠ è½½åŸæœ‰çš„ç¤ºä¾‹å›¾è¡¨æ•°æ®
                    loadDemoCharts();
                    
                    // ç„¶ååŠ è½½APIæ•°æ®
                    await loadClimateCharts();
                    await loadSoilCharts();
                    await loadCropCharts();
                    await loadZoningCharts();
                    
                    console.log('ğŸ‰ æ‰€æœ‰å›¾è¡¨åŠ è½½å®Œæˆ');
                }, 500);
                
            } catch (error) {
                console.error('âŒ å›¾è¡¨åŠ è½½å¤±è´¥:', error);
            }
        }
        
        // æ˜¾ç¤ºå›¾è¡¨åŠ è½½çŠ¶æ€
        function showChartLoading(chartId, message) {
            console.log(`â³ ${chartId}: ${message}`);
        }
        
        // åŠ è½½ç¤ºä¾‹å›¾è¡¨æ•°æ®
        function loadDemoCharts() {
            console.log('ğŸ“Š åŠ è½½ç¤ºä¾‹å›¾è¡¨æ•°æ®...');
            
            // ç¤ºä¾‹åœŸå£¤ç±»å‹é¥¼å›¾
            if (window.SparkCore.charts.soilTypePieChart) {
                const option = {
                    title: { text: 'åœŸå£¤ç±»å‹åˆ†å¸ƒ', left: 'center' },
                    tooltip: { trigger: 'item' },
                    series: [{
                        type: 'pie',
                        radius: '60%',
                        data: [
                            { value: 35, name: 'çº¢å£¤' },
                            { value: 25, name: 'é»„å£¤' },
                            { value: 20, name: 'æ°´ç¨»åœŸ' },
                            { value: 15, name: 'ç´«è‰²åœŸ' },
                            { value: 5, name: 'å…¶ä»–' }
                        ]
                    }]
                };
                window.SparkCore.charts.soilTypePieChart.setOption(option);
                console.log('âœ… åœŸå£¤ç±»å‹å›¾ç¤ºä¾‹åŠ è½½å®Œæˆ');
            }
            
            // ç¤ºä¾‹ä½œç‰©åˆ†å¸ƒå›¾
            if (window.SparkCore.charts.suitabilityDistChart) {
                const option = {
                    title: { text: 'ä½œç‰©åˆ†ç±»åˆ†å¸ƒ', left: 'center' },
                    tooltip: { trigger: 'item' },
                    series: [{
                        type: 'pie',
                        radius: '60%',
                        data: [
                            { value: 30, name: 'ç²®é£Ÿä½œç‰©' },
                            { value: 25, name: 'ç»æµä½œç‰©' },
                            { value: 20, name: 'è”¬èœ' },
                            { value: 15, name: 'æ°´æœ' },
                            { value: 10, name: 'å…¶ä»–' }
                        ]
                    }]
                };
                window.SparkCore.charts.suitabilityDistChart.setOption(option);
                console.log('âœ… ä½œç‰©åˆ†å¸ƒå›¾ç¤ºä¾‹åŠ è½½å®Œæˆ');
            }
            
            // ç¤ºä¾‹å¿å¸‚è´¨é‡æ’å
            if (window.SparkCore.charts.countyQualityChart) {
                const option = {
                    title: { text: 'å¿å¸‚åœŸå£¤è´¨é‡æ’å', left: 'center' },
                    tooltip: { trigger: 'axis' },
                    xAxis: { 
                        type: 'category',
                        data: ['é•¿æ²™å¿', 'æµé˜³å¸‚', 'å®ä¹¡å¸‚', 'æœ›åŸåŒº', 'å²³éº“åŒº'],
                        axisLabel: { rotate: 45 }
                    },
                    yAxis: { type: 'value', name: 'è´¨é‡è¯„åˆ†' },
                    series: [{
                        name: 'è´¨é‡è¯„åˆ†',
                        type: 'bar',
                        data: [85, 82, 78, 75, 72]
                    }]
                };
                window.SparkCore.charts.countyQualityChart.setOption(option);
                console.log('âœ… å¿å¸‚è´¨é‡å›¾ç¤ºä¾‹åŠ è½½å®Œæˆ');
            }
            
            console.log('ğŸ‰ ç¤ºä¾‹å›¾è¡¨åŠ è½½å®Œæˆ');
        }
        
        // åŠ è½½æ°”å€™å›¾è¡¨
        async function loadClimateCharts() {
            try {
                console.log('ğŸŒ¡ï¸ åŠ è½½æ°”å€™å›¾è¡¨...');
                
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                showChartLoading('tempTrendChart', 'æ­£åœ¨åŠ è½½æ¸©åº¦è¶‹åŠ¿æ•°æ®...');
                showChartLoading('precipPatternChart', 'æ­£åœ¨åŠ è½½é™æ°´æ¨¡å¼æ•°æ®...');
                showChartLoading('climateHeatmapChart', 'æ­£åœ¨åŠ è½½æ°”å€™çƒ­åŠ›å›¾æ•°æ®...');
                
                const response = await fetch('/api/echarts/climate_trends');
                const result = await response.json();
                
                if (result.status === 'success') {
                    const charts_data = result.charts;
                    console.log('ğŸ“ˆ æ°”å€™å›¾è¡¨æ•°æ®:', Object.keys(charts_data));
                    
                    // æ¸©åº¦è¶‹åŠ¿å›¾
                    if (charts_data.temperature_trend) {
                        const tempElement = document.getElementById('tempTrendChart');
                        if (tempElement) {
                            // å¼ºåˆ¶æ¸…é™¤å¹¶é‡æ–°åˆå§‹åŒ–
                            tempElement.innerHTML = '';
                            tempElement.style.width = '100%';
                            tempElement.style.height = '400px';
                            
                            const chart = echarts.init(tempElement);
                            window.SparkCore.charts.tempTrendChart = chart;
                            
                            chart.setOption({
                                title: { 
                                    text: 'æœˆåº¦æ¸©åº¦å˜åŒ–è¶‹åŠ¿',
                                    left: 'center',
                                    textStyle: { fontSize: 16, fontWeight: 'bold' }
                                },
                                tooltip: { trigger: 'axis' },
                                xAxis: { 
                                    type: 'category',
                                    data: charts_data.temperature_trend.xAxis || [],
                                    axisLabel: { fontSize: 12 }
                                },
                                yAxis: { 
                                    type: 'value', 
                                    name: 'æ¸©åº¦(Â°C)',
                                    nameTextStyle: { fontSize: 12 }
                                },
                                series: charts_data.temperature_trend.series || []
                            });
                            console.log('âœ… æ¸©åº¦è¶‹åŠ¿å›¾è®¾ç½®å®Œæˆ');
                        }
                    }
                    
                    // å¹´åº¦è¶‹åŠ¿å›¾
                    if (charts_data.annual_trend && window.SparkCore.charts.precipPatternChart) {
                        window.SparkCore.charts.precipPatternChart.setOption({
                            title: { 
                                text: 'å¹´åº¦æ¸©åº¦è¶‹åŠ¿',
                                left: 'center',
                                textStyle: { fontSize: 16, fontWeight: 'bold' }
                            },
                            tooltip: { trigger: 'axis' },
                            xAxis: { 
                                type: 'category',
                                data: charts_data.annual_trend.xAxis || []
                            },
                            yAxis: { 
                                type: 'value', 
                                name: 'æ¸©åº¦(Â°C)'
                            },
                            series: charts_data.annual_trend.series || []
                        });
                        console.log('âœ… å¹´åº¦è¶‹åŠ¿å›¾è®¾ç½®å®Œæˆ');
                    }
                    
                    console.log('âœ… æ°”å€™å›¾è¡¨åŠ è½½å®Œæˆ');
                } else {
                    console.error('âŒ æ°”å€™å›¾è¡¨APIè¿”å›é”™è¯¯:', result.message);
                }
            } catch (error) {
                console.error('âŒ åŠ è½½æ°”å€™å›¾è¡¨å¤±è´¥:', error);
            }
        }
        
        // åŠ è½½åœŸå£¤å›¾è¡¨
        async function loadSoilCharts() {
            try {
                console.log('ğŸ”ï¸ åŠ è½½åœŸå£¤å›¾è¡¨...');
                
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                showChartLoading('soilTypePieChart', 'æ­£åœ¨åŠ è½½åœŸå£¤ç±»å‹æ•°æ®...');
                showChartLoading('phDistChart', 'æ­£åœ¨åŠ è½½pHåˆ†å¸ƒæ•°æ®...');
                showChartLoading('countyQualityChart', 'æ­£åœ¨åŠ è½½å¿å¸‚è´¨é‡æ•°æ®...');
                
                const response = await fetch('/api/echarts/soil_analysis');
                const result = await response.json();
                
                if (result.status === 'success') {
                    const charts_data = result.charts;
                    console.log('ğŸ“ˆ åœŸå£¤å›¾è¡¨æ•°æ®:', Object.keys(charts_data));
                    
                    // åœŸå£¤ç±»å‹åˆ†å¸ƒé¥¼å›¾
                    if (charts_data.soil_type_pie && window.SparkCore.charts.soilTypePieChart) {
                        window.SparkCore.charts.soilTypePieChart.setOption({
                            title: { 
                                text: 'åœŸå£¤ç±»å‹åˆ†å¸ƒ',
                                left: 'center',
                                textStyle: { fontSize: 16, fontWeight: 'bold' }
                            },
                            tooltip: { 
                                trigger: 'item',
                                formatter: '{a} <br/>{b}: {c} ({d}%)'
                            },
                            legend: { 
                                orient: 'vertical', 
                                left: 'left'
                            },
                            series: [{
                                name: 'åœŸå£¤ç±»å‹',
                                type: 'pie',
                                radius: '60%',
                                data: charts_data.soil_type_pie.data || []
                            }]
                        });
                        console.log('âœ… åœŸå£¤ç±»å‹é¥¼å›¾è®¾ç½®å®Œæˆ');
                    }
                    
                    // pHåˆ†å¸ƒæŸ±çŠ¶å›¾
                    if (charts_data.ph_distribution && window.SparkCore.charts.phDistChart) {
                        window.SparkCore.charts.phDistChart.setOption({
                            title: { 
                                text: 'pHå€¼åˆ†å¸ƒ',
                                left: 'center',
                                textStyle: { fontSize: 16, fontWeight: 'bold' }
                            },
                            tooltip: { trigger: 'axis' },
                            xAxis: { 
                                type: 'category',
                                data: charts_data.ph_distribution.xAxis || []
                            },
                            yAxis: { 
                                type: 'value', 
                                name: 'æ ·æœ¬æ•°é‡'
                            },
                            series: charts_data.ph_distribution.series || []
                        });
                        console.log('âœ… pHåˆ†å¸ƒå›¾è®¾ç½®å®Œæˆ');
                    }
                    
                    // å¿å¸‚è´¨é‡æ’å
                    if (charts_data.county_quality_ranking && window.SparkCore.charts.countyQualityChart) {
                        window.SparkCore.charts.countyQualityChart.setOption({
                            title: { 
                                text: 'å¿å¸‚åœŸå£¤è´¨é‡æ’å',
                                left: 'center',
                                textStyle: { fontSize: 16, fontWeight: 'bold' }
                            },
                            tooltip: { trigger: 'axis' },
                            xAxis: { 
                                type: 'category',
                                data: charts_data.county_quality_ranking.xAxis || [],
                                axisLabel: { rotate: 45 }
                            },
                            yAxis: { 
                                type: 'value', 
                                name: 'è´¨é‡è¯„åˆ†'
                            },
                            series: charts_data.county_quality_ranking.series || []
                        });
                        console.log('âœ… å¿å¸‚è´¨é‡æ’åå›¾è®¾ç½®å®Œæˆ');
                    }
                    
                    console.log('âœ… åœŸå£¤å›¾è¡¨åŠ è½½å®Œæˆ');
                } else {
                    console.error('âŒ åœŸå£¤å›¾è¡¨APIè¿”å›é”™è¯¯:', result.message);
                }
            } catch (error) {
                console.error('âŒ åŠ è½½åœŸå£¤å›¾è¡¨å¤±è´¥:', error);
            }
        }
        
        // åŠ è½½ä½œç‰©å›¾è¡¨
        async function loadCropCharts() {
            try {
                console.log('ğŸŒ¾ åŠ è½½ä½œç‰©å›¾è¡¨...');
                
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                showChartLoading('suitabilityDistChart', 'æ­£åœ¨åŠ è½½ä½œç‰©åˆ†ç±»æ•°æ®...');
                showChartLoading('cropRadarChart', 'æ­£åœ¨åŠ è½½ä½œç‰©æ¸©åº¦éœ€æ±‚æ•°æ®...');
                showChartLoading('limitingFactorsChart', 'æ­£åœ¨åŠ è½½ä½œç‰©pHé€‚åº”æ€§æ•°æ®...');
                
                const response = await fetch('/api/echarts/crop_suitability');
                const result = await response.json();
                
                if (result.status === 'success') {
                    const charts_data = result.charts;
                    console.log('ğŸ“ˆ ä½œç‰©å›¾è¡¨æ•°æ®:', Object.keys(charts_data));
                    
                    // ä½œç‰©åˆ†ç±»åˆ†å¸ƒ
                    if (charts_data.suitability_distribution && window.SparkCore.charts.suitabilityDistChart) {
                        window.SparkCore.charts.suitabilityDistChart.setOption({
                            title: { 
                                text: 'ä½œç‰©åˆ†ç±»åˆ†å¸ƒ',
                                left: 'center',
                                textStyle: { fontSize: 16, fontWeight: 'bold' }
                            },
                            tooltip: { 
                                trigger: 'item',
                                formatter: '{a} <br/>{b}: {c}ç§ ({d}%)'
                            },
                            legend: { 
                                orient: 'vertical', 
                                left: 'left'
                            },
                            series: [{
                                name: 'ä½œç‰©åˆ†ç±»',
                                type: 'pie',
                                radius: '60%',
                                data: charts_data.suitability_distribution.data || []
                            }]
                        });
                        console.log('âœ… ä½œç‰©åˆ†ç±»åˆ†å¸ƒå›¾è®¾ç½®å®Œæˆ');
                    }
                    
                    // ä½œç‰©æ¸©åº¦éœ€æ±‚
                    if (charts_data.crop_advantages_radar && window.SparkCore.charts.cropRadarChart) {
                        window.SparkCore.charts.cropRadarChart.setOption({
                            title: { 
                                text: 'ä½œç‰©æ¸©åº¦éœ€æ±‚',
                                left: 'center',
                                textStyle: { fontSize: 16, fontWeight: 'bold' }
                            },
                            tooltip: { trigger: 'axis' },
                            xAxis: { 
                                type: 'category',
                                data: charts_data.crop_advantages_radar.xAxis || []
                            },
                            yAxis: { 
                                type: 'value', 
                                name: 'æ¸©åº¦(Â°C)'
                            },
                            series: charts_data.crop_advantages_radar.series || []
                        });
                        console.log('âœ… ä½œç‰©æ¸©åº¦éœ€æ±‚å›¾è®¾ç½®å®Œæˆ');
                    }
                    
                    // ä½œç‰©pHé€‚åº”æ€§
                    if (charts_data.limiting_factors_pie && window.SparkCore.charts.limitingFactorsChart) {
                        window.SparkCore.charts.limitingFactorsChart.setOption({
                            title: { 
                                text: 'ä½œç‰©pHé€‚åº”æ€§',
                                left: 'center',
                                textStyle: { fontSize: 16, fontWeight: 'bold' }
                            },
                            tooltip: { 
                                trigger: 'item',
                                formatter: '{a} <br/>{b}: {c}ç§ä½œç‰© ({d}%)'
                            },
                            legend: { 
                                orient: 'vertical', 
                                left: 'left'
                            },
                            series: [{
                                name: 'pHé€‚åº”æ€§',
                                type: 'pie',
                                radius: '60%',
                                data: charts_data.limiting_factors_pie.data || []
                            }]
                        });
                        console.log('âœ… ä½œç‰©pHé€‚åº”æ€§å›¾è®¾ç½®å®Œæˆ');
                    }
                    
                    console.log('âœ… ä½œç‰©å›¾è¡¨åŠ è½½å®Œæˆ');
                } else {
                    console.error('âŒ ä½œç‰©å›¾è¡¨APIè¿”å›é”™è¯¯:', result.message);
                }
            } catch (error) {
                console.error('âŒ åŠ è½½ä½œç‰©å›¾è¡¨å¤±è´¥:', error);
            }
        }
        
        // åŠ è½½åŒºåˆ’å›¾è¡¨
        async function loadZoningCharts() {
            try {
                console.log('ğŸ—ºï¸ åŠ è½½åŒºåˆ’å›¾è¡¨...');
                
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                showChartLoading('zoningScatterChart', 'æ­£åœ¨åŠ è½½åŒºåˆ’ä¼˜åŒ–æ•°æ®...');
                showChartLoading('optimizationMapChart', 'æ­£åœ¨åŠ è½½æœ€ä½³ç§æ¤åŒºåŸŸæ•°æ®...');
                
                const response = await fetch('/api/echarts/zoning_optimization');
                const result = await response.json();
                
                if (result.status === 'success') {
                    const charts_data = result.charts;
                    console.log('ğŸ“ˆ åŒºåˆ’å›¾è¡¨æ•°æ®:', Object.keys(charts_data));
                    
                    // åŒºåˆ’ä¼˜åŒ–æ•£ç‚¹å›¾
                    if (charts_data.zoning_scatter && window.SparkCore.charts.zoningScatterChart) {
                        window.SparkCore.charts.zoningScatterChart.setOption({
                            title: { 
                                text: 'åŒºåˆ’ä¼˜åŒ–åˆ†å¸ƒ',
                                left: 'center',
                                textStyle: { fontSize: 16, fontWeight: 'bold' }
                            },
                            tooltip: { 
                                trigger: 'item',
                                formatter: function(params) {
                                    return `${params.data[2]}<br/>pHå€¼: ${params.data[0]}<br/>è´¨é‡è¯„åˆ†: ${params.data[1]}`;
                                }
                            },
                            xAxis: { 
                                type: 'value', 
                                name: 'pHå€¼'
                            },
                            yAxis: { 
                                type: 'value', 
                                name: 'è´¨é‡è¯„åˆ†'
                            },
                            series: charts_data.zoning_scatter.series || []
                        });
                        console.log('âœ… åŒºåˆ’ä¼˜åŒ–æ•£ç‚¹å›¾è®¾ç½®å®Œæˆ');
                    }
                    
                    // æœ€ä½³ç§æ¤åŒºåŸŸ
                    if (charts_data.optimization_map && window.SparkCore.charts.optimizationMapChart) {
                        const mapData = charts_data.optimization_map.series[0].data || [];
                        const cityNames = mapData.map(item => item[2] || 'æœªçŸ¥åŸå¸‚');
                        const cityValues = mapData.map((item, index) => index + 1);
                        
                        window.SparkCore.charts.optimizationMapChart.setOption({
                            title: { 
                                text: 'æœ€ä½³ç§æ¤åŒºåŸŸ',
                                left: 'center',
                                textStyle: { fontSize: 16, fontWeight: 'bold' }
                            },
                            tooltip: { trigger: 'axis' },
                            xAxis: { 
                                type: 'category',
                                data: cityNames,
                                axisLabel: { rotate: 45 }
                            },
                            yAxis: { 
                                type: 'value', 
                                name: 'ä¼˜åŒ–æ’å'
                            },
                            series: [{
                                name: 'ä¼˜åŒ–æ’å',
                                type: 'bar',
                                data: cityValues,
                                itemStyle: {
                                    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                        {offset: 0, color: '#83bff6'},
                                        {offset: 0.5, color: '#188df0'},
                                        {offset: 1, color: '#188df0'}
                                    ])
                                }
                            }]
                        });
                        console.log('âœ… æœ€ä½³ç§æ¤åŒºåŸŸå›¾è®¾ç½®å®Œæˆ');
                    }
                    
                    console.log('âœ… åŒºåˆ’å›¾è¡¨åŠ è½½å®Œæˆ');
                } else {
                    console.error('âŒ åŒºåˆ’å›¾è¡¨APIè¿”å›é”™è¯¯:', result.message);
                }
            } catch (error) {
                console.error('âŒ åŠ è½½åŒºåˆ’å›¾è¡¨å¤±è´¥:', error);
            }
        }
        
        
        // æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨
        function showLoadingIndicator(message = 'åŠ è½½ä¸­...') {
            let indicator = document.getElementById('loadingIndicator');
            if (!indicator) {
                indicator = document.createElement('div');
                indicator.id = 'loadingIndicator';
                indicator.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0,0,0,0.8);
                    color: white;
                    padding: 20px 30px;
                    border-radius: 5px;
                    z-index: 9999;
                    text-align: center;
                `;
                document.body.appendChild(indicator);
            }
            
            indicator.innerHTML = `
                <div style="margin-bottom: 10px;">
                    <div style="border: 3px solid #f3f3f3; border-top: 3px solid #007bff; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto;"></div>
                </div>
                <div>${message}</div>
            `;
            indicator.style.display = 'block';
        }
        
        // éšè—åŠ è½½æŒ‡ç¤ºå™¨
        function hideLoadingIndicator() {
            const indicator = document.getElementById('loadingIndicator');
            if (indicator) {
                indicator.style.display = 'none';
            }
        }
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 5px;
                color: white;
                z-index: 9999;
                max-width: 300px;
                animation: slideIn 0.3s ease-out;
            `;
            
            switch(type) {
                case 'success':
                    notification.style.background = '#28a745';
                    break;
                case 'error':
                    notification.style.background = '#dc3545';
                    break;
                default:
                    notification.style.background = '#007bff';
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // 3ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }
        
        
        
        // ç›´æ¥åˆå§‹åŒ–å¹¶æ˜¾ç¤ºå›¾è¡¨
        function initAndShowCharts() {
            console.log('ï¿½ å¼€å§‹åˆå§‹åŒ–å¹¶æ˜¾ç¤ºå›¾è¡¨...');
            
            // æ£€æŸ¥EChartsæ˜¯å¦åŠ è½½
            if (typeof echarts === 'undefined') {
                console.error('âŒ EChartsåº“æœªåŠ è½½ï¼Œ3ç§’åé‡è¯•...');
                setTimeout(initAndShowCharts, 3000);
                return;
            }
            
            // å›¾è¡¨é…ç½®
            const chartConfigs = {
                soilTypePieChart: {
                    title: { text: 'åœŸå£¤ç±»å‹åˆ†å¸ƒ', left: 'center' },
                    tooltip: { trigger: 'item' },
                    series: [{
                        type: 'pie',
                        radius: '60%',
                        data: [
                            { value: 35, name: 'çº¢å£¤' },
                            { value: 25, name: 'é»„å£¤' },
                            { value: 20, name: 'æ°´ç¨»åœŸ' },
                            { value: 15, name: 'ç´«è‰²åœŸ' },
                            { value: 5, name: 'å…¶ä»–' }
                        ]
                    }]
                },
                suitabilityDistChart: {
                    title: { text: 'ä½œç‰©åˆ†ç±»åˆ†å¸ƒ', left: 'center' },
                    tooltip: { trigger: 'item' },
                    series: [{
                        type: 'pie',
                        radius: '60%',
                        data: [
                            { value: 30, name: 'ç²®é£Ÿä½œç‰©' },
                            { value: 25, name: 'ç»æµä½œç‰©' },
                            { value: 20, name: 'è”¬èœ' },
                            { value: 15, name: 'æ°´æœ' },
                            { value: 10, name: 'å…¶ä»–' }
                        ]
                    }]
                },
                countyQualityChart: {
                    title: { text: 'å¿å¸‚åœŸå£¤è´¨é‡æ’å', left: 'center' },
                    tooltip: { trigger: 'axis' },
                    xAxis: { 
                        type: 'category',
                        data: ['é•¿æ²™å¿', 'æµé˜³å¸‚', 'å®ä¹¡å¸‚', 'æœ›åŸåŒº', 'å²³éº“åŒº'],
                        axisLabel: { rotate: 45 }
                    },
                    yAxis: { type: 'value', name: 'è´¨é‡è¯„åˆ†' },
                    series: [{
                        name: 'è´¨é‡è¯„åˆ†',
                        type: 'bar',
                        data: [85, 82, 78, 75, 72]
                    }]
                }
            };
            
            // æ‰€æœ‰å›¾è¡¨ID
            const allChartIds = [
                'tempTrendChart', 'precipPatternChart', 'climateHeatmapChart',
                'soilTypePieChart', 'phDistChart', 'countyQualityChart',
                'suitabilityDistChart', 'cropRadarChart', 'limitingFactorsChart',
                'zoningScatterChart', 'optimizationMapChart'
            ];
            
            // åˆå§‹åŒ–æ‰€æœ‰å›¾è¡¨
            allChartIds.forEach(chartId => {
                const element = document.getElementById(chartId);
                if (element) {
                    // å¼ºåˆ¶æ¸…é™¤æ‰€æœ‰å†…å®¹ï¼ŒåŒ…æ‹¬åŠ è½½åŠ¨ç”»
                    element.innerHTML = '';
                    element.style.width = '100%';
                    element.style.height = '400px';
                    element.style.minHeight = '400px';
                    
                    // åªå¤„ç†æœ‰æ•°æ®é…ç½®çš„å›¾è¡¨
                    if (chartConfigs[chartId]) {
                        try {
                            // åˆå§‹åŒ–EChartså®ä¾‹
                            const chart = echarts.init(element);
                            
                            // è®¾ç½®å›¾è¡¨é€‰é¡¹
                            chart.setOption(chartConfigs[chartId]);
                            console.log(`âœ… ${chartId} æ•°æ®å›¾è¡¨åˆ›å»ºæˆåŠŸ`);
                            
                            // ä¿å­˜å›¾è¡¨å®ä¾‹
                            window.SparkCore.charts[chartId] = chart;
                            
                        } catch (error) {
                            console.error(`âŒ ${chartId} åˆ›å»ºå¤±è´¥:`, error);
                            // å¦‚æœEChartså¤±è´¥ï¼Œä¿æŒç©ºç™½
                            element.innerHTML = '';
                        }
                    } else {
                        // æ²¡æœ‰æ•°æ®é…ç½®çš„å›¾è¡¨ä¿æŒç©ºç™½
                        console.log(`â­ï¸ ${chartId} è·³è¿‡ï¼Œæ— æ•°æ®é…ç½®`);
                    }
                }
            });
            
            console.log('ğŸ‰ æ‰€æœ‰å›¾è¡¨åˆå§‹åŒ–å®Œæˆ');
        }
        
        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“„ é¡µé¢åŠ è½½å®Œæˆ');
            
            // æ·»åŠ CSSåŠ¨ç”»
            const style = document.createElement('style');
            style.textContent = `
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                .chart-loading {
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    text-align: center;
                    color: #666;
                }
            `;
            document.head.appendChild(style);
            
            // åˆå§‹åŒ–æ ‡ç­¾é¡µ
            initTabs();
            
            // ç›´æ¥åˆå§‹åŒ–å›¾è¡¨
            setTimeout(initCharts, 1000);
            
            // å»¶è¿ŸåŠ è½½ç¤ºä¾‹æ•°æ®
            setTimeout(loadDemoCharts, 1500);
            
            // ç»‘å®šäº‹ä»¶
            const initBtn = document.getElementById('initSystemBtn');
            const runBtn = document.getElementById('runAnalysisBtn');
            
            if (initBtn) {
                initBtn.addEventListener('click', initializeSystem);
            }
            
            if (runBtn) {
                runBtn.addEventListener('click', runAnalysis);
            }
            
            console.log('ğŸ‰ ç³»ç»Ÿå°±ç»ª');
        });
        
        // çª—å£å¤§å°æ”¹å˜æ—¶è°ƒæ•´å›¾è¡¨
        window.addEventListener('resize', function() {
            Object.values(window.SparkCore.charts).forEach(chart => {
                if (chart && chart.resize) {
                    chart.resize();
                }
            });
        });
    </script>
</body>
</html>
