<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸©åº¦åˆ†æ - æ¹–å—çœå†œä¸šåˆ†æç³»ç»Ÿ</title>
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Microsoft YaHei', Arial, sans-serif;
        }
        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .chart-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            padding: 20px;
        }
        .chart-container {
            width: 100%;
            height: 400px;
        }
        .btn-back {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar navbar-dark">
        <div class="container-fluid">
            <span class="navbar-brand">ğŸŒ¡ï¸ æ¸©åº¦åˆ†æ</span>
            <a href="/" class="btn btn-back">â† è¿”å›ä¸»é¡µ</a>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- æœˆåº¦æ¸©åº¦è¶‹åŠ¿ -->
        <div class="chart-card">
            <h5 class="card-title">ğŸ“ˆ æœˆåº¦æ¸©åº¦å˜åŒ–è¶‹åŠ¿</h5>
            <div id="monthlyTempChart" class="chart-container"></div>
        </div>

        <!-- å¹´åº¦æ¸©åº¦è¶‹åŠ¿ -->
        <div class="chart-card">
            <h5 class="card-title">ğŸ“Š å¹´åº¦æ¸©åº¦è¶‹åŠ¿</h5>
            <div id="annualTempChart" class="chart-container"></div>
        </div>

        <!-- å­£èŠ‚æ¸©åº¦å¯¹æ¯” -->
        <div class="chart-card">
            <h5 class="card-title">ğŸ”„ å­£èŠ‚æ¸©åº¦å¯¹æ¯”</h5>
            <div id="seasonalTempChart" class="chart-container"></div>
        </div>
    </div>

    <script>
        console.log('ğŸŒ¡ï¸ æ¸©åº¦åˆ†æé¡µé¢å¯åŠ¨');

        // åˆå§‹åŒ–å›¾è¡¨
        function initCharts() {
            console.log('ğŸ“Š åˆå§‹åŒ–æ¸©åº¦åˆ†æå›¾è¡¨');
            
            // æœˆåº¦æ¸©åº¦è¶‹åŠ¿å›¾
            const monthlyChart = echarts.init(document.getElementById('monthlyTempChart'));
            
            // å¹´åº¦æ¸©åº¦è¶‹åŠ¿å›¾
            const annualChart = echarts.init(document.getElementById('annualTempChart'));
            
            // å­£èŠ‚æ¸©åº¦å¯¹æ¯”å›¾
            const seasonalChart = echarts.init(document.getElementById('seasonalTempChart'));
            
            return { monthlyChart, annualChart, seasonalChart };
        }

        // åŠ è½½æ¸©åº¦æ•°æ®
        async function loadTemperatureData() {
            console.log('ğŸ”„ åŠ è½½æ¸©åº¦æ•°æ®');
            
            try {
                const response = await fetch('/api/echarts/climate_trends');
                const result = await response.json();
                
                if (result.status === 'success') {
                    const charts = initCharts();
                    
                    // è®¾ç½®æœˆåº¦æ¸©åº¦è¶‹åŠ¿
                    if (result.charts.temperature_trend) {
                        const tempData = result.charts.temperature_trend;
                        charts.monthlyChart.setOption({
                            title: { text: tempData.title, left: 'center' },
                            tooltip: { trigger: 'axis' },
                            xAxis: { 
                                type: 'category',
                                data: tempData.xAxis
                            },
                            yAxis: { 
                                type: 'value',
                                name: 'æ¸©åº¦(Â°C)'
                            },
                            series: tempData.series
                        });
                        console.log('âœ… æœˆåº¦æ¸©åº¦å›¾è¡¨åŠ è½½æˆåŠŸ');
                    }
                    
                    // è®¾ç½®å¹´åº¦æ¸©åº¦è¶‹åŠ¿
                    if (result.charts.annual_trend) {
                        const annualData = result.charts.annual_trend;
                        charts.annualChart.setOption({
                            title: { text: annualData.title, left: 'center' },
                            tooltip: { trigger: 'axis' },
                            xAxis: { 
                                type: 'category',
                                data: annualData.xAxis
                            },
                            yAxis: { 
                                type: 'value',
                                name: 'æ¸©åº¦(Â°C)'
                            },
                            series: annualData.series
                        });
                        console.log('âœ… å¹´åº¦æ¸©åº¦å›¾è¡¨åŠ è½½æˆåŠŸ');
                    }
                    
                    // è®¾ç½®å­£èŠ‚æ¸©åº¦å¯¹æ¯”
                    if (result.charts.seasonal_comparison) {
                        const seasonalData = result.charts.seasonal_comparison;
                        charts.seasonalChart.setOption({
                            title: { text: seasonalData.title, left: 'center' },
                            tooltip: { trigger: 'item' },
                            series: [{
                                type: 'pie',
                                radius: '60%',
                                data: seasonalData.data
                            }]
                        });
                        console.log('âœ… å­£èŠ‚æ¸©åº¦å›¾è¡¨åŠ è½½æˆåŠŸ');
                    }
                    
                } else {
                    console.error('âŒ æ¸©åº¦æ•°æ®åŠ è½½å¤±è´¥:', result.message);
                    alert('æ¸©åº¦æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·å…ˆè¿è¡Œç³»ç»Ÿåˆ†æ');
                }
            } catch (error) {
                console.error('âŒ æ¸©åº¦æ•°æ®è¯·æ±‚å¼‚å¸¸:', error);
                alert('æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“„ æ¸©åº¦åˆ†æé¡µé¢åŠ è½½å®Œæˆ');
            
            // å»¶è¿ŸåŠ è½½æ•°æ®ï¼Œç¡®ä¿EChartså®Œå…¨åŠ è½½
            setTimeout(loadTemperatureData, 1000);
        });

        // çª—å£å¤§å°æ”¹å˜æ—¶è°ƒæ•´å›¾è¡¨
        window.addEventListener('resize', function() {
            const charts = document.querySelectorAll('.chart-container');
            charts.forEach(container => {
                const chart = echarts.getInstanceByDom(container);
                if (chart) {
                    chart.resize();
                }
            });
        });
    </script>
</body>
</html>
